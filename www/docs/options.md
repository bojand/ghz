---
id: options
title: Options Reference
---

The `ghz` command line has numerous command line options.  You can run `ghz --help` to view all available options.

<AUTOGENERATED_TABLE_OF_CONTENTS>

### `--proto`

The path to The Protocol Buffer .proto file for input. If no `-proto` or `-protoset` options are used, we attempt to perform [server reflection](https://github.com/grpc/grpc/blob/master/doc/server-reflection.md).

### `--protoset`

Alternatively we use compiled protoset file (containing compiled descriptors, produced by `protoc`) as input.
To create a protoset file, invoke `protoc` with the `*.proto` files that define the service. For example:

```sh
protoc --proto_path=. --descriptor_set_out=bundle.protoset *.proto
```

If no `-proto` or `-protoset` options are used, we attempt to perform server reflection.

### `--call`

A fully-qualified method name in 'package.Service/Method' or 'package.Service.Method' format. For example: `helloworld.Greeter.SayHello`. With regard to measurement, we use [WithStatsHandler](https://godoc.org/google.golang.org/grpc#WithStatsHandler) option to capture call metrics. Specifically we only capture the [End](https://godoc.org/google.golang.org/grpc/stats#End) event which contains stats when an RPC ends. This should include the download of the payload and deserializing of the data.

### `--cacert`

Path to the file containing trusted root certificates for verifying the server. By default `ghz` tries to create a secure connection using the system's default root certificate. The certificate file can be specified using `-cacert` option. The TLS verification can be skipped using `-skipTLS` option.

### `--cert`

Path to the file containing client certificate (public key), to present to the server. Must also provide `-key` option when this is used.

### `--key`

File containing client private key, to present to the server. Must also provide `-cert` option.

### `--cname`

Server name override when validating TLS certificate.

### `--skipTLS`

Skip TLS client verification of the server's certificate chain and host name.

### `--insecure`

Use plaintext and insecure connection.

### `--authority`

Value to be used as the `:authority` pseudo-header. Only works if `-insecure` is used.

### `-config`

Path to the JSON or TOML [config file](example_config.md) that specifies all the test settings.

Config file settings can be combined with command line arguments. CLI options overwrite config file options.

```sh
ghz --config=./config.json -c 20 -n 1000
```

### `-c`, `--concurrency`

Number of requests to run concurrently. Total number of requests cannot be smaller than the concurrency level. Default is `50`. For example to do requests in series without any concurrency set to `1`. `ghz` takes the `concurrency` argument and spawns that many worker goroutines. By default all goroutine workers share a single connection.

### `-n`, `--total`

The total number of requests to run. Default is `200`. The combination of `-c` and `-n` are critical in how the benchmarking is done. `ghz` takes the `-c` argument and spawns that many worker goroutines. In parallel these goroutines each do their share (`n / c`) requests. So for example with the default `-c 50 -n 200` options we would spawn `50` goroutines which in parallel each do `4` requests.

### `-q`, `--qps`

Rate limit for each worker goroutine in queries per second (QPS). Default is no rate limit. This essentially spaces out the requests by adding a timeout to each worker before it attempts each call.

### `-t`, `--timeout`

Timeout for each request. Default is `20s`, use zero value for infinite.

### `-z`, `--duration`

Duration of application to send requests. When duration is reached, application stops and exits. If duration is specified, `n` is ignored. Examples: `-z 10s` or `-z 3m`.

### `--duration-stop`

Option on how to handle in-flight requests when duration specified using `duration` option is reached. Options are `close`, `wait`, and `ignore`. `close` will cause the connections to close immediately, and any requests that have yet to complete will likely error out and be reported with `transport is closing` error. `wait` will make all in-flight requests to be completed and reported. These requests still have the regular request `timeout` constraint. Finally, `ignore` option is similar to `close` that the connections are terminated immediately, however any in-flight requests that complete are completely ignored in the reporting.

### `-x`, `--max-duration`

Maximum duration of application to send requests with `n` setting respected. If duration is reached before `n` requests are completed, application stops and exits. Examples: `-x 10s` or `-x 3m`.

### `--connections`

By default we use a single gRPC connection for the whole test run, and the concurrency (`-c`) is achieved using goroutine workers sharing this single connection. The number of gRPC connections used can be controlled using this parameter. This parameter cannot exceed concurrency option. The specified number of connections will be distributed evenly to be shared among the concurrency goroutine workers. So for example a concurrency of `10` and using `5` connections will result in `10` goroutine workers, each pair of `2` workers sharing `1` of the `5` connections. Each worker will get its share of the total number of requests specified using `-n` option.

### `-d`, `--data`

The call data as stringified JSON. If the value is `@` then the request contents are read from standard input (stdin). Example: `-d '{"name":"Bob"}'`.

For unary requests we accept a single message or an array of messages. In case of a single message we repeat the unary call with this message throughout the test. In case of array the messages will be sent in round-robin fashion. For example with `-d '[{"name":"Joe"},{"name":"Kate"},{"name":"Sara"}]'` the server will get Joe, Kate and Sara requests repeatedly.

For client streaming or bi-directional calls we accept a JSON array of messages, each element representing a single message within the stream call. For example: `-d '[{"name":"Joe"},{"name":"Kate"},{"name":"Sara"}]'` can be used as input for a client streaming or bidi call. In case of streaming calls if a single object is given for data then it is automatically converted to an array with single element. For example `-d '{"name":"Joe"}'` is equivalent to `-d '[{"name":"Joe"}]`. Round-robin for streaming requests is not supported.

In case of client streaming we send all the messages in the input array and then we close and receive.

### `-D`, `--data-file`

The path for call data JSON file. For example, `-D /home/user/file.json` or `-D ./file.json`.

### `-b`, `--binary`

The call data comes as serialized protocol buffer messages read from standard input. 

We support two formats of binary data: single message and multiple count-delimited messages. See [writing a message](https://developers.google.com/protocol-buffers/docs/gotutorial#writing-a-message) on how to serialize a single message. 

For multiple messages prefix each message with its length in bytes. See [streaming multiple messages](https://developers.google.com/protocol-buffers/docs/techniques#streaming) in protobuf documentation.

Code example:
```go
msg1 := &helloworld.HelloRequest{}
msg1.Name = "Alice"
msg2 := &helloworld.HelloRequest{}
msg2.Name = "Bob"

buf := proto.Buffer{}
_ = buf.EncodeMessage(msg1)
_ = buf.EncodeMessage(msg2)
			
binData := buf.Bytes() // pass this as input
```

### `-B`, `--binary-file`

Path for the call data as serialized binary message. The format is the same as for `-b` switch.

### `-m`, `--metadata`

Request metadata as stringified JSON.

### `-M`, `--metadata-file`

Path for call metadata JSON file. For example, `-M /home/user/metadata.json` or `-M ./metadata.json`.

### `--stream-interval`

Stream interval duration. Spread stream sends by given amount. Only applies to client and bidi streaming calls. Example: `100ms`

### `--reflect-metadata`

Reflect metadata as stringified JSON used only for reflection request.

### `-o`, `--output`

Output path. If none is provided by default we print to standard output (stdout).

### `-O`, `--format`

Output type. If none provided, a summary is printed.

- `"csv"` - outputs the response metrics in comma-separated values format.
- `"json"` - outputs the metrics report in JSON format.
- `"pretty"` - outputs the metrics report in pretty JSON format.
- `"html"` - outputs the metrics report as HTML.
- `"influx-summary"` - outputs the metrics summary as InfluxDB line protocol.
- `"influx-details"` - outputs the metrics details as InfluxDB line protocol.

See [output formats page](output.md) for details.

### `-i`, `--import-paths`

Comma separated list of proto import paths. The current working directory and the directory of the protocol buffer file specified using `-proto` are automatically added to the import list.

### `--connect-timeout`

Connection timeout duration for the initial connection dial. Default is `10s`.

### `--keepalive`

Keepalive time duration. Only used if present and above `0`.

### `--name`

A user specified name for the test.

### `--tags`

JSON string representation of user-defined string tags. This is mainly for reporting purposes. For example `-tags '{"env":"staging","created by":"Joe Developer"}'`.

### `--cpus`

Number of used cpu cores to be used for the test. The default is the total number of logical CPUs on the local machine.

### `--debug`

Enables debug logging to a file specified by the path. The debug logger outputs JSON line format. Use this only for debugging purposes.

```sh
ghz --insecure \
  --proto ./protos/greeter.proto \
  --call helloworld.Greeter.SayHello \
  -d '{"name":"Joe"}' -c 5 -n 50 -m '{"request-id":"{{.RequestNumber}}", "timestamp":"{{.TimestampUnix}}"}' \
  --debug ./logs/debug.json \
  0.0.0.0:50051
```

### `-v`, `--version`

Print the version.

### `-h`, `--help`                

Show context-sensitive help (also try --help-long and --help-man).

### `-e`, `--enable-compression`               

Enable gzip compression on requests.